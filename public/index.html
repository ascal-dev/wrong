<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WP JSON Fast Blog</title>
<meta name="theme-color" content="#ffffff">

<style>
:root{
  --bg:#f5f7fb;--card:#fff;--text:#111827;
  --muted:#6b7280;--primary:#2563eb;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);color:var(--text);
  padding-bottom:80px;
}
header{
  position:sticky;top:0;z-index:10;
  background:#fff;padding:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.06)
}
header input{
  width:100%;padding:12px 16px;
  border-radius:999px;border:1px solid #e5e7eb;
  font-size:15px
}
main{max-width:900px;margin:auto;padding:14px}

.card{
  display:flex;gap:14px;align-items:center;
  background:var(--card);border-radius:16px;
  padding:12px;margin-bottom:14px;
  cursor:pointer
}
.thumb{
  width:120px;height:80px;object-fit:cover;
  border-radius:12px;background:#eee;
  flex-shrink:0
}
.title{font-weight:600;font-size:15px}
.meta{font-size:12px;color:var(--muted)}

.pagination{
  display:flex;flex-wrap:wrap;gap:8px;
  justify-content:center;margin:20px 0;align-items:center
}
.pagination button,.pagination input{
  padding:8px 12px;border-radius:999px;
  border:1px solid #e5e7eb;background:#fff;
  cursor:pointer
}

.single{
  background:var(--card);border-radius:20px;
  padding:16px
}
.single img{
  width:100%;border-radius:16px;
  margin-bottom:12px
}
.nav{margin-bottom:10px}
.nav button{
  padding:8px 14px;border-radius:999px;
  border:1px solid #e5e7eb;background:#fff;
  cursor:pointer
}

.video-link{
  display:flex;align-items:center;gap:12px;
  padding:12px;border:1px solid #e5e7eb;
  border-radius:14px;margin:14px 0;
  cursor:pointer
}
.play{
  width:40px;height:40px;border-radius:50%;
  background:var(--primary);color:#fff;
  display:flex;align-items:center;
  justify-content:center
}
video{width:100%;margin-top:10px;border-radius:14px}

.ad-box{margin:16px 0;border-radius:16px;overflow:hidden}
</style>
</head>
<body>

<header>
   <div><a href="./instagrammodel.html">Insta Model</a></div>
  <input id="search" placeholder="Search posts...">
</header>

<main id="posts"></main>

<script>

/* CONFIG */
const API_BASE = 'https://leakemms.ascalrack.workers.dev/?url=https://www.soniyabedi.in/blog/wp-json/wp/v2/posts?_embed';
const PER_PAGE = 10; 
const MAIN_AD_URL = 'https://www.effectivegatecpm.com/udpve945?key=7cd66743658c606e293d255b9b789ef5';
const POPUNDER_SCRIPT = 'https://pl28772002.effectivegatecpm.com/8e/59/71/8e5971f333df02f76a99caef6bfba4e3.js';
const ACTION_LIMIT = 1;

let page = 1;
let totalPages = 1;
let search = '';
let actionCount = 0;
let popLoaded = false;

const posts = document.getElementById('posts');

window.history.scrollRestoration = "manual";

/* ---------------- SCROLL MEMORY ---------------- */

function saveScroll(){
  const state = history.state || {};
  state.scroll = window.scrollY;
  history.replaceState(state, '', location.href);
}

function restoreScroll(){
  const y = history.state?.scroll || 0;
  setTimeout(()=> window.scrollTo(0,y), 50);
}

window.addEventListener('scroll', saveScroll);

/* ---------------- BROWSER BLOCKER ---------------- */

async function checkBrowser() {
  try{
    const isBrave = navigator.brave && await navigator.brave.isBrave();
    const userAgent = navigator.userAgent.toLowerCase();
    const isUlla = userAgent.includes('ulla');
    if (isBrave || isUlla) {
      document.body.innerHTML = `<h1 style="text-align:center;padding:40px;color:red;">Access Denied</h1>`;
      window.stop();
      throw new Error("Blocked");
    }
  }catch(e){}
}

/* ---------------- ADS ---------------- */

function loadPopunder(){
  if(popLoaded) return;
  popLoaded = true;
  const s = document.createElement('script');
  s.src = POPUNDER_SCRIPT;
  s.async = true;
  document.body.appendChild(s);
}

function trackActionWithAd(){
  actionCount++;
  if(actionCount === 1) loadPopunder();
  if(actionCount % ACTION_LIMIT === 0) {
    window.open(MAIN_AD_URL, '_blank');
  }
}

/* ---------------- ROUTING ---------------- */

window.addEventListener('popstate', route);

function route(){
  checkBrowser().then(()=>{

    const q = new URLSearchParams(location.search);
    const postId = q.get('post');

    if(postId){
      loadSingle(postId, true);
    }else{
      page = Number(q.get('page')) || 1;
      search = q.get('search') || '';
      document.getElementById('search').value = search;
      loadPosts(true);
    }

  });
}

/* ---------------- HELPERS ---------------- */

async function getThumb(p){
  let thumb = p._embedded?.['wp:featuredmedia']?.[0]?.source_url;
  if(!thumb && p.featured_media){
    try{
      const r = await fetch(`https://www.soniyabedi.in/blog/wp-json/wp/v2/media/${p.featured_media}`);
      const data = await r.json();
      thumb = data.source_url;
    }catch(e){ thumb=''; }
  }
  return thumb || '';
}

/* ---------------- LOAD POSTS ---------------- */

async function loadPosts(fromHistory=false){
  posts.innerHTML='Loading…';

  const r = await fetch(`${API_BASE}&per_page=${PER_PAGE}&page=${page}&search=${encodeURIComponent(search)}`);
  totalPages = parseInt(r.headers.get('X-WP-TotalPages')||1);
  const d = await r.json();

  posts.innerHTML='';

  for(let i=0;i<d.length;i++){
    const p=d[i];
    const img=await getThumb(p);

    if(i%3===0){
      const ad=document.createElement('div');
      ad.className='ad-box';
      ad.innerHTML=`<iframe style="width:100%;height:250px;border:0" src="${MAIN_AD_URL}"></iframe>`;
      posts.appendChild(ad);
    }

    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=img?
      `<img class="thumb" src="${img}"><div><div class="title">${p.title.rendered}</div><div class="meta">${new Date(p.date).toLocaleString()}</div></div>`
      :`<div class="title">${p.title.rendered}</div>`;

    c.onclick=()=>{
      trackActionWithAd();
      saveScroll();
      openPost(p.id);
    };

    posts.appendChild(c);
  }

  renderPagination();

  if(fromHistory) restoreScroll();
  else window.scrollTo(0,0);
}

/* ---------------- PAGINATION ---------------- */

function renderPagination(){
  const container=document.createElement('div');
  container.className='pagination';

  const prev=document.createElement('button');
  prev.textContent='Prev';
  prev.disabled=page<=1;
  prev.onclick=()=>{
    trackActionWithAd();
    saveScroll();
    if(page>1){page--;pushListState();loadPosts();}
  };

  const next=document.createElement('button');
  next.textContent='Next';
  next.disabled=page>=totalPages;
  next.onclick=()=>{
    trackActionWithAd();
    saveScroll();
    if(page<totalPages){page++;pushListState();loadPosts();}
  };

  const input=document.createElement('input');
  input.type='number';
  input.value=page;
  input.style.width='60px';

  const go=document.createElement('button');
  go.textContent='Go';
  go.onclick=()=>{
    trackActionWithAd();
    saveScroll();
    const val=parseInt(input.value);
    if(val>=1&&val<=totalPages){page=val;pushListState();loadPosts();}
  };

  container.append(prev,next,input,go);
  posts.appendChild(container);
}

function pushListState(){
  history.pushState(
    {type:'list',page,search,scroll:0},
    '',
    `?page=${page}&search=${encodeURIComponent(search)}`
  );
}

/* ---------------- SINGLE POST ---------------- */

function openPost(id){
  history.pushState(
    {type:'post',id,scroll:0},
    '',
    `?post=${id}`
  );
  loadSingle(id);
}

async function loadSingle(id,fromHistory=false){

  const r=await fetch(`${API_BASE}&include=${id}`);
  const data=await r.json();
  const p=data[0];
  const img=await getThumb(p);

  const firstPara=p.content.rendered.match(/<p>[\s\S]*?<\/p>/i)?.[0]||'';
  const mp4s=[...p.content.rendered.matchAll(/https?:\/\/[^\s"'<>]+\.mp4/gi)].map(m=>m[0]);

  posts.innerHTML=`
    <div class="single">
      <div class="nav"><button id="back-btn">Back</button></div>
      <div class="ad-box"><iframe style="width:100%;height:250px;border:0" src="${MAIN_AD_URL}"></iframe></div>
      ${img?`<img src="${img}">`:''}
      <h1>${p.title.rendered}</h1>
      <div class="ad-box"><iframe style="width:100%;height:250px;border:0" src="${MAIN_AD_URL}"></iframe></div>
      ${firstPara}
      <div class="ad-box"><iframe style="width:100%;height:250px;border:0" src="${MAIN_AD_URL}"></iframe></div>
      ${mp4s.map((u,i)=>`
        <div class="video-link" id="vid-btn-${i}">
          <div class="play">▶</div>
          <div>Viral Video ${i+1}</div>
        </div>
        <div id="player-${i}"></div>
      `).join('')}
    </div>
  `;

  document.getElementById('back-btn').onclick=()=>{
    trackActionWithAd();
    saveScroll();
    history.back();
  };

  mp4s.forEach((u,i)=>{
    document.getElementById(`vid-btn-${i}`).onclick=()=>{
      trackActionWithAd();
      document.getElementById(`player-${i}`).innerHTML=
        `<video controls autoplay src="${u}"></video>`;
    };
  });

  if(fromHistory) restoreScroll();
  else window.scrollTo(0,0);
}

/* ---------------- SEARCH ---------------- */

document.getElementById('search').addEventListener('keyup',(e)=>{
  if(e.key==='Enter'){
    trackActionWithAd();
    search=e.target.value;
    page=1;
    pushListState();
    loadPosts();
  }
});

/* ---------------- INIT ---------------- */

if(!history.state){
  history.replaceState({type:'list',page,search,scroll:0},'',location.href);
}

route();

</script>
</body>
</html>
