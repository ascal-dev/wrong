<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WP JSON Fast Blog - Unlimited Scroll</title>
<style>
/* PRESERVED ORIGINAL STYLING */
:root{
  --bg:#f5f7fb;--card:#fff;--text:#111827;
  --muted:#6b7280;--primary:#2563eb;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);color:var(--text);
  padding-bottom:80px;
}
header{
  position:sticky;top:0;z-index:10;
  background:#fff;padding:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.06)
}
header input{
  width:100%;padding:12px 16px;
  border-radius:999px;border:1px solid #e5e7eb;
  font-size:15px
}
main{max-width:900px;margin:auto;padding:14px}

.card{
  display:flex;gap:14px;align-items:center;
  background:var(--card);border-radius:16px;
  padding:12px;margin-bottom:14px;
  cursor:pointer;transition: transform 0.2s;
}
.card:active { transform: scale(0.98); }
.thumb{
  width:120px;height:80px;object-fit:cover;
  border-radius:12px;background:#eee;
  flex-shrink:0
}
.title{font-weight:600;font-size:15px}
.meta{font-size:12px;color:var(--muted)}

.single{
  background:var(--card);border-radius:20px;
  padding:16px
}
.single img{
  width:100%;border-radius:16px;
  margin-bottom:12px
}
.nav{margin-bottom:10px}
.nav button{
  padding:8px 14px;border-radius:999px;
  border:1px solid #e5e7eb;background:#fff;
  cursor:pointer
}

.video-link{
  display:flex;align-items:center;gap:12px;
  padding:12px;border:1px solid #e5e7eb;
  border-radius:14px;margin:14px 0;
  cursor:pointer
}
.play{
  width:40px;height:40px;border-radius:50%;
  background:var(--primary);color:#fff;
  display:flex;align-items:center;
  justify-content:center
}
video{width:100%;margin-top:10px;border-radius:14px}

.ad-box{margin:16px 0;border-radius:16px;overflow:hidden;background:#eee;min-height:250px;}
#loader { text-align: center; padding: 20px; color: var(--muted); font-size: 14px; }
</style>
</head>
<body>

<header>
  <input id="search" placeholder="Search all posts...">
</header>

<main id="posts"></main>

<div id="loader">Loading more content...</div>

<script>
/* CONFIG */
const API_BASE = 'https://allinone.ascalrack.workers.dev/?url=https://www.soniyabedi.in/blog/wp-json/wp/v2/posts?_embed&per_page=1000';
const MAIN_AD_URL = 'https://www.effectivegatecpm.com/udpve945?key=7cd66743658c606e293d255b9b789ef5';
const POPUNDER_SCRIPT = 'https://pl28772002.effectivegatecpm.com/8e/59/71/8e5971f333df02f76a99caef6bfba4e3.js';

let popLoaded = false;
let currentSearch = '';

const postsContainer = document.getElementById('posts');
const searchInput = document.getElementById('search');

// Browser Blocker
async function checkBrowser() {
    const isBrave = navigator.brave && await navigator.brave.isBrave();
    if (isBrave) {
        document.body.innerHTML = `<div style="padding:50px;text-align:center;"><h1>Unsupported Browser</h1></div>`;
        window.stop();
        throw new Error("Blocked");
    }
}

function trackActionWithAd(){
    if(!popLoaded) {
        popLoaded = true;
        const s = document.createElement('script');
        s.src = POPUNDER_SCRIPT;
        document.body.appendChild(s);
    }
    window.open(MAIN_AD_URL,'_blank');
}

async function loadPosts() {
    postsContainer.innerHTML = `<div id="loader">Loading posts...</div>`;
    try {
        const url = `${API_BASE}${currentSearch ? '&search=' + encodeURIComponent(currentSearch) : ''}`;
        const response = await fetch(url);
        const data = await response.json();

        postsContainer.innerHTML = ''; // clear loader
        data.forEach(post => {
            const img = post.schema?.thumbnailUrl || post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';

            // Ads between cards
            const ad = document.createElement('div');
            ad.className = 'ad-box';
            ad.innerHTML = `<iframe src="${MAIN_AD_URL}" style="width:100%;height:250px;border:0" loading="lazy"></iframe>`;
            postsContainer.appendChild(ad);

            // Post Card
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                ${img ? `<img class="thumb" src="${img}" loading="lazy">` : ''}
                <div>
                    <div class="title">${post.title.rendered}</div>
                    <div class="meta">${new Date(post.date).toLocaleDateString()}</div>
                </div>
            `;
            card.onclick = () => { trackActionWithAd(); openPost(post.id); };
            postsContainer.appendChild(card);
        });
    } catch(e) {
        postsContainer.innerHTML = "<div style='text-align:center;color:red;'>Error loading posts.</div>";
        console.error(e);
    }
}

// Search Handling
searchInput.addEventListener('input', (e) => {
    currentSearch = e.target.value;
    loadPosts();
});

function openPost(id) {
    history.pushState({post: id}, '', `?post=${id}`);
    renderSingle(id);
}

async function renderSingle(id) {
    const res = await fetch(`${API_BASE}&include=${id}`);
    const post = (await res.json())[0];
    const img = post.schema?.thumbnailUrl || post._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
    const mp4s = [...post.content.rendered.matchAll(/https?:\/\/[^\s"'<>]+\.mp4/gi)].map(m => m[0]);

    postsContainer.innerHTML = `
        <div class="single">
            <div class="nav"><button onclick="location.href=location.pathname">← Back</button></div>
            ${img ? `<img src="${img}">` : ''}
            <h1>${post.title.rendered}</h1>
            <div class="ad-box"><iframe src="${MAIN_AD_URL}" style="width:100%;height:250px;border:0"></iframe></div>
            <div class="post-content">${post.content.rendered}</div>
            ${mp4s.map((url, i) => `
                <div class="video-link" onclick="trackActionWithAd(); this.nextElementSibling.innerHTML='<video controls autoplay src=\\'${url}\\'></video>'">
                    <div class="play">▶</div>
                    <div>Watch Viral Video ${i+1}</div>
                </div>
                <div class="video-container"></div>
            `).join('')}
        </div>
    `;
    window.scrollTo(0,0);
}

// Initial Route Logic
function init() {
    checkBrowser().then(() => {
        const params = new URLSearchParams(location.search);
        if (params.get('post')) renderSingle(params.get('post'));
        else loadPosts();
    });
}

window.onpopstate = () => location.reload();
init();
</script>
</body>
</html>
