<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WP JSON Fast Blog</title>
<style>
/* ORIGINAL CSS PRESERVED */
:root{
  --bg:#f5f7fb;--card:#fff;--text:#111827;
  --muted:#6b7280;--primary:#2563eb;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);color:var(--text);
  padding-bottom:120px; /* Increased for sticky ad */
}
header{
  position:sticky;top:0;z-index:100;
  background:#fff;padding:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.06)
}
header input{
  width:100%;padding:12px 16px;
  border-radius:999px;border:1px solid #e5e7eb;
  font-size:15px
}
main{max-width:900px;margin:auto;padding:14px}

.card{
  display:flex;gap:14px;align-items:center;
  background:var(--card);border-radius:16px;
  padding:12px;margin-bottom:14px;
  cursor:pointer
}
.thumb{
  width:120px;height:80px;object-fit:cover;
  border-radius:12px;background:#eee;
  flex-shrink:0
}
.title{font-weight:600;font-size:15px}
.meta{font-size:12px;color:var(--muted)}

.pagination{
  display:flex;flex-wrap:wrap;gap:8px;
  justify-content:center;margin:20px 0
}
.pagination button,.pagination input{
  padding:8px 12px;border-radius:999px;
  border:1px solid #e5e7eb;background:#fff
}
.pagination button.active{
  background:var(--primary);color:#fff
}

.single{
  background:var(--card);border-radius:20px;
  padding:16px
}
.single img{
  width:100%;border-radius:16px;
  margin-bottom:12px
}
.nav{margin-bottom:10px}
.nav button{
  padding:8px 14px;border-radius:999px;
  border:1px solid #e5e7eb;background:#fff;
  cursor:pointer
}

.video-link{
  display:flex;align-items:center;gap:12px;
  padding:12px;border:1px solid #e5e7eb;
  border-radius:14px;margin:14px 0;
  cursor:pointer
}
.play{
  width:40px;height:40px;border-radius:50%;
  background:var(--primary);color:#fff;
  display:flex;align-items:center;
  justify-content:center
}
video{width:100%;margin-top:10px;border-radius:14px}

/* AD STYLING */
.ad-box{margin:16px 0;border-radius:16px;overflow:hidden;background:#eee;text-align:center}
.ad-label{font-size:10px;color:#999;margin-bottom:4px;text-transform:uppercase;letter-spacing:1px}
.sticky-ad {
    position: fixed; bottom: 0; left: 0; width: 100%; 
    height: 90px; background: #fff; z-index: 999; 
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    border-top: 1px solid #ddd;
}
</style>
</head>
<body>

<header>
  <input id="search" placeholder="Search viral posts...">
</header>

<main id="posts"></main>

<div class="sticky-ad">
    <iframe src="https://www.effectivegatecpm.com/udpve945?key=7cd66743658c606e293d255b9b789ef5" width="100%" height="90" frameborder="0" scrolling="no"></iframe>
</div>

<script>
/* CONFIG */
const API_BASE = 'https://www.soniyabedi.in/blog/wp-json/wp/v2/posts?_embed';
const AD_URL = 'https://www.effectivegatecpm.com/udpve945?key=7cd66743658c606e293d255b9b789ef5';
const POP_JS = 'https://pl28772002.effectivegatecpm.com/8e/59/71/8e5971f333df02f76a99caef6bfba4e3.js';
const ACTION_LIMIT = 2; // Ad opens every 2nd click

let page = 1;
let totalPages = 1;
let actionCount = 0;

const postsContainer = document.getElementById('posts');

// 1. BRAVE/ULLA BLOCKER
async function checkBlocker() {
    const isBrave = navigator.brave && await navigator.brave.isBrave();
    const isUlla = navigator.userAgent.toLowerCase().includes('ulla');
    if (isBrave || isUlla) {
        document.body.innerHTML = `<div style="padding:100px 20px;text-align:center;"><h1>Access Denied</h1><p>Brave/Ulla browsers are not allowed. Use Chrome or Safari.</p></div>`;
        window.stop();
        throw new Error("Blocked");
    }
}

// 2. AD TRACKING
function triggerAd() {
    actionCount++;
    if (actionCount % ACTION_LIMIT === 0) {
        window.open(AD_URL, '_blank');
    }
}

// 3. AD GENERATOR HTML
function getAdHTML(height = 250) {
    return `<div class="ad-box">
                <div class="ad-label">Advertisement</div>
                <iframe style="width:100%;height:${height}px;border:0" src="${AD_URL}" loading="lazy"></iframe>
            </div>`;
}

async function loadPosts() {
    postsContainer.innerHTML = 'Loading...';
    const r = await fetch(`${API_BASE}&per_page=10&page=${page}`);
    const data = await r.json();
    postsContainer.innerHTML = '';

    data.forEach((p) => {
        // Ad ABOVE post
        postsContainer.innerHTML += getAdHTML(250);

        const card = document.createElement('div');
        card.className = 'card';
        const img = p._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
        card.innerHTML = img 
            ? `<img class="thumb" src="${img}"><div><div class="title">${p.title.rendered}</div><div class="meta">${new Date(p.date).toDateString()}</div></div>`
            : `<div><div class="title">${p.title.rendered}</div></div>`;
        
        card.onclick = () => { triggerAd(); loadSingle(p.id); };
        postsContainer.appendChild(card);

        // Ad BELOW post
        postsContainer.innerHTML += getAdHTML(150);
    });
}

async function loadSingle(id) {
    const r = await fetch(`${API_BASE}&include=${id}`);
    const data = await r.json();
    const p = data[0];
    const img = p._embedded?.['wp:featuredmedia']?.[0]?.source_url || '';
    const mp4s = [...p.content.rendered.matchAll(/https?:\/\/[^\s"'<>]+\.mp4/gi)].map(m => m[0]);

    postsContainer.innerHTML = `
        <div class="single">
            <div class="nav"><button onclick="triggerAd(); loadPosts();">Back</button></div>
            ${getAdHTML(250)}
            ${img ? `<img src="${img}">` : ''}
            <h1>${p.title.rendered}</h1>
            
            ${getAdHTML(300)}
            ${getAdHTML(300)}
            
            <div class="post-content">${p.content.rendered.split('</p>')[0]}</p></div>
            
            ${getAdHTML(250)}

            ${mp4s.map((u, i) => `
                <div class="video-link" onclick="triggerAd(); this.nextElementSibling.innerHTML='<video src=\'${u}\' controls autoplay></video>'">
                    <div class="play">â–¶</div>
                    <div>Watch Video ${i+1} (Unlock Content)</div>
                </div>
                <div class="player-slot"></div>
                ${getAdHTML(250)}
            `).join('')}
            
            ${getAdHTML(250)}
            ${getAdHTML(250)}
        </div>
    `;
    window.scrollTo(0,0);
}

// Start
checkBlocker().then(() => {
    loadPosts();
    // Load Popunder
    const s = document.createElement('script');
    s.src = POP_JS;
    document.body.appendChild(s);
});
</script>
</body>
</html>
